syntax = "proto3";

import "token.proto";

package vixen.parser.token_extensions;

// ── Enums ──────────────────────────────────────────────────────────

enum AuthorityType {
  AUTHORITY_TYPE_MINT_TOKENS = 0;
  AUTHORITY_TYPE_FREEZE_ACCOUNT = 1;
  AUTHORITY_TYPE_ACCOUNT_OWNER = 2;
  AUTHORITY_TYPE_CLOSE_ACCOUNT = 3;
  AUTHORITY_TYPE_TRANSFER_FEE_CONFIG = 4;
  AUTHORITY_TYPE_WITHHELD_WITHDRAW = 5;
  AUTHORITY_TYPE_CLOSE_MINT = 6;
  AUTHORITY_TYPE_INTEREST_RATE = 7;
  AUTHORITY_TYPE_PERMANENT_DELEGATE = 8;
  AUTHORITY_TYPE_CONFIDENTIAL_TRANSFER_MINT = 9;
  AUTHORITY_TYPE_TRANSFER_HOOK_PROGRAM_ID = 10;
  AUTHORITY_TYPE_CONFIDENTIAL_TRANSFER_FEE_CONFIG = 11;
  AUTHORITY_TYPE_METADATA_POINTER = 12;
  AUTHORITY_TYPE_GROUP_POINTER = 13;
  AUTHORITY_TYPE_GROUP_MEMBER_POINTER = 14;
  AUTHORITY_TYPE_SCALED_UI_AMOUNT = 15;
  AUTHORITY_TYPE_PAUSE = 16;
}

enum ExtensionWithCommonInstruction {
  EXTENSION_WITH_COMMON_INSTRUCTION_CPI_GUARD = 0;
  EXTENSION_WITH_COMMON_INSTRUCTION_DEFAULT_ACCOUNT_STATE = 1;
  EXTENSION_WITH_COMMON_INSTRUCTION_INTEREST_BEARING_MINT = 2;
  EXTENSION_WITH_COMMON_INSTRUCTION_MEMO_TRANSFER = 3;
  EXTENSION_WITH_COMMON_INSTRUCTION_GROUP_MEMBER_POINTER = 4;
  EXTENSION_WITH_COMMON_INSTRUCTION_GROUP_POINTER = 5;
  EXTENSION_WITH_COMMON_INSTRUCTION_METADATA_POINTER = 6;
  EXTENSION_WITH_COMMON_INSTRUCTION_TRANSFER_HOOK = 7;
}

// ── Account state ──────────────────────────────────────────────────

message Mint {
  optional bytes mint_authority = 1;
  uint64 supply = 2;
  uint32 decimals = 3;
  bool is_initialized = 4;
  optional bytes freeze_authority = 5;
}

message Account {
  bytes mint = 1;
  bytes owner = 2;
  uint64 amount = 3;
  optional bytes delegate = 4;
  uint32 state = 5;
  optional uint64 is_native = 6;
  uint64 delegated_amount = 7;
  optional bytes close_authority = 8;
}

message Multisig {
  uint32 m = 1;
  uint32 n = 2;
  bool is_initialized = 3;
  repeated bytes signers = 4;
}

message ExtensionData {
  int32 extension_type = 1;
  bytes data = 2;
}

message ExtendedMint {
  Mint base_account = 1;
  repeated ExtensionData extensions = 2;
}

message ExtendedTokenAccount {
  Account base_account = 1;
  repeated ExtensionData extensions = 2;
}

message TokenExtensionState {
  oneof state {
    ExtendedTokenAccount extended_token_account = 1;
    ExtendedMint extended_mint = 2;
    Multisig multisig = 3;
  }
}

// ── Common Extension Instructions ──────────────────────────────────

message ExtInitializeAccounts {
  bytes mint = 1;
}

message UpdateAccounts {
  bytes mint = 1;
  bytes extension_authority = 2;
  repeated bytes multisig_signers = 3;
}

message EnableAccounts {
  bytes account = 1;
  bytes owner = 2;
  repeated bytes multisig_signers = 3;
}

message DisableAccounts {
  bytes account = 1;
  bytes owner = 2;
  repeated bytes multisig_signers = 3;
}

message CommonExtensionInstructions {
  message Initialize {
    ExtInitializeAccounts accounts = 1;
  }
  message Update {
    UpdateAccounts accounts = 1;
  }
  message Enable {
    EnableAccounts accounts = 1;
  }
  message Disable {
    DisableAccounts accounts = 1;
  }

  int32 extension = 1;
  oneof instruction {
    Initialize initialize = 2;
    Update update = 3;
    Enable enable = 4;
    Disable disable = 5;
  }
}

// ── Transfer Fee Extension ─────────────────────────────────────────

message TransferCheckedWithFeeAccounts {
  bytes source = 1;
  bytes mint = 2;
  bytes destination = 3;
  bytes owner = 4;
  repeated bytes multisig_signers = 5;
}

message TransferCheckedWithFeeArgs {
  uint64 amount = 1;
  uint64 fee_amount = 2;
  uint32 decimals = 3;
}

message InitializeTransferFeeConfigAccounts {
  bytes mint = 1;
}

message InitializeTransferFeeConfigArgs {
  optional bytes transfer_fee_config_authority = 1;
  optional bytes withdraw_withheld_authority = 2;
  uint32 transfer_fee_basis_points = 3;
  uint64 maximum_fee = 4;
}

message WithdrawWithheldTokensFromMintAccounts {
  bytes mint = 1;
  bytes fee_recipient = 2;
  bytes withdraw_withheld_authority = 3;
  repeated bytes multisig_signers = 4;
}

message WithdrawWithheldTokensFromAccountsAccounts {
  bytes mint = 1;
  bytes fee_recipient = 2;
  bytes withdraw_withheld_authority = 3;
  repeated bytes source_accounts = 4;
  repeated bytes multisig_signers = 5;
}

message WithdrawWithheldTokensFromAccountsArgs {
  uint32 num_token_accounts = 1;
}

message SetTransferFeeAccounts {
  bytes mint = 1;
  bytes mint_fee_acc_owner = 2;
  repeated bytes multisig_signers = 3;
}

message SetTransferFeeArgs {
  uint32 transfer_fee_basis_points = 1;
  uint64 maximum_fee = 2;
}

message HarvestWithheldTokensToMintAccounts {
  bytes mint = 1;
  bytes mint_fee_acc_owner = 2;
}

message TransferFeeIx {
  message TransferCheckedWithFee {
    TransferCheckedWithFeeAccounts accounts = 1;
    TransferCheckedWithFeeArgs args = 2;
  }
  message InitializeTransferFeeConfig {
    InitializeTransferFeeConfigAccounts accounts = 1;
    InitializeTransferFeeConfigArgs args = 2;
  }
  message WithdrawWithheldTokensFromMint {
    WithdrawWithheldTokensFromMintAccounts accounts = 1;
  }
  message WithdrawWithheldTokensFromAccounts {
    WithdrawWithheldTokensFromAccountsAccounts accounts = 1;
    WithdrawWithheldTokensFromAccountsArgs args = 2;
  }
  message HarvestWithheldTokensToMint {
    HarvestWithheldTokensToMintAccounts accounts = 1;
  }
  message SetTransferFee {
    SetTransferFeeAccounts accounts = 1;
    SetTransferFeeArgs args = 2;
  }

  oneof instruction {
    TransferCheckedWithFee transfer_checked_with_fee = 1;
    InitializeTransferFeeConfig initialize_transfer_fee_config = 2;
    WithdrawWithheldTokensFromMint withdraw_withheld_tokens_from_mint = 3;
    WithdrawWithheldTokensFromAccounts withdraw_withheld_tokens_from_accounts = 4;
    HarvestWithheldTokensToMint harvest_withheld_tokens_to_mint = 5;
    SetTransferFee set_transfer_fee = 6;
  }
}

// ── Token Metadata Extension ───────────────────────────────────────

message InitializeAccounts {
  bytes metadata = 1;
  bytes update_authority = 2;
  bytes mint = 3;
  bytes mint_authority = 4;
}

message InitializeArgs {
  bytes raw = 1;
}

message UpdateFieldAccounts {
  bytes metadata = 1;
  bytes update_authority = 2;
}

message UpdateFieldArgs {
  bytes raw = 1;
}

message RemoveKeyAccounts {
  bytes metadata = 1;
  bytes update_authority = 2;
}

message RemoveKeyArgs {
  bytes raw = 1;
}

message UpdateAuthorityAccounts {
  bytes metadata = 1;
  bytes current_update_authority = 2;
}

message UpdateAuthorityArgs {
  bytes raw = 1;
}

message EmitAccounts {
  bytes metadata = 1;
}

message EmitArgs {
  bytes raw = 1;
}

message TokenMetadataIx {
  message Initialize {
    InitializeAccounts accounts = 1;
    InitializeArgs args = 2;
  }
  message UpdateField {
    UpdateFieldAccounts accounts = 1;
    UpdateFieldArgs args = 2;
  }
  message RemoveKey {
    RemoveKeyAccounts accounts = 1;
    RemoveKeyArgs args = 2;
  }
  message UpdateAuthority {
    UpdateAuthorityAccounts accounts = 1;
    UpdateAuthorityArgs args = 2;
  }
  message Emit {
    EmitAccounts accounts = 1;
    EmitArgs args = 2;
  }

  oneof instruction {
    Initialize initialize = 1;
    UpdateField update_field = 2;
    RemoveKey remove_key = 3;
    UpdateAuthority update_authority = 4;
    Emit emit = 5;
  }
}

// ── Token Group Extension ──────────────────────────────────────────

message InitializeGroupAccounts {
  bytes group = 1;
  bytes mint = 2;
  bytes mint_authority = 3;
}

message InitializeGroupArgs {
  uint64 max_size = 1;
  optional bytes update_authority = 2;
}

message UpdateGroupMaxSizeAccounts {
  bytes group = 1;
  bytes update_authority = 2;
}

message UpdateGroupMaxSizeArgs {
  uint64 max_size = 1;
}

message UpdateGroupAuthorityAccounts {
  bytes group = 1;
  bytes current_authority = 2;
}

message UpdateGroupAuthorityArgs {
  bytes new_authority = 1;
}

message InitializeMemberAccounts {
  bytes member = 1;
  bytes member_mint = 2;
  bytes member_mint_authority = 3;
  bytes group = 4;
  bytes group_update_authority = 5;
}

message InitializeMemberArgs {}

message TokenGroupIx {
  message InitializeGroup {
    InitializeGroupAccounts accounts = 1;
    InitializeGroupArgs args = 2;
  }
  message UpdateGroupMaxSize {
    UpdateGroupMaxSizeAccounts accounts = 1;
    UpdateGroupMaxSizeArgs args = 2;
  }
  message UpdateGroupAuthority {
    UpdateGroupAuthorityAccounts accounts = 1;
    UpdateGroupAuthorityArgs args = 2;
  }
  message InitializeMember {
    InitializeMemberAccounts accounts = 1;
    InitializeMemberArgs args = 2;
  }

  oneof instruction {
    InitializeGroup initialize_group = 1;
    UpdateGroupMaxSize update_group_max_size = 2;
    UpdateGroupAuthority update_group_authority = 3;
    InitializeMember initialize_member = 4;
  }
}

// ── Confidential Transfer Extension ────────────────────────────────

message UpdateMintAccounts {
  bytes mint = 1;
  bytes authority = 2;
}

message ConfigureAccountAccounts {
  bytes account = 1;
  bytes mint = 2;
  bytes sysvar = 3;
  bytes owner = 4;
  repeated bytes multisig_signers = 5;
}

message ApproveAccountAccounts {
  bytes account = 1;
  bytes mint = 2;
  bytes authority = 3;
}

message EmptyAccountAccounts {
  bytes account = 1;
  bytes sysvar = 2;
  bytes owner = 3;
  repeated bytes multisig_signers = 4;
}

message DepositAccounts {
  bytes account = 1;
  bytes mint = 2;
  bytes owner = 3;
  repeated bytes multisig_signers = 4;
}

message WithdrawAccounts {
  bytes source_account = 1;
  bytes mint = 2;
  bytes destination = 3;
  bytes owner = 4;
  repeated bytes multisig_signers = 5;
}

message ConfidentialTransferAccounts {
  bytes source_account = 1;
  bytes mint = 2;
  bytes destination = 3;
  bytes context_account = 4;
  bytes owner = 5;
  repeated bytes multisig_signers = 6;
}

message ApplyPendingBalanceAccounts {
  bytes account = 1;
  bytes owner = 2;
  repeated bytes multisig_signers = 3;
}

message CreditsAccounts {
  bytes account = 1;
  bytes owner = 2;
  repeated bytes multisig_signers = 3;
}

message TransferWithFeeAccounts {
  bytes source_account = 1;
  bytes mint = 2;
  bytes destination = 3;
}

message ConfigureAccountWithRegistryAccounts {
  bytes account = 1;
  bytes mint = 2;
  bytes registry = 3;
}

message ConfidentialTransferIx {
  message InitializeMint {
    vixen.parser.token.InitializeMintAccounts accounts = 1;
  }
  message UpdateMint {
    UpdateMintAccounts accounts = 1;
  }
  message ConfigureAccount {
    ConfigureAccountAccounts accounts = 1;
  }
  message ApproveAccount {
    ApproveAccountAccounts accounts = 1;
  }
  message EmptyAccount {
    EmptyAccountAccounts accounts = 1;
  }
  message Deposit {
    DepositAccounts accounts = 1;
  }
  message Withdraw {
    WithdrawAccounts accounts = 1;
  }
  message Transfer {
    ConfidentialTransferAccounts accounts = 1;
  }
  message ApplyPendingBalance {
    ApplyPendingBalanceAccounts accounts = 1;
  }
  message EnableConfidentialCredits {
    CreditsAccounts accounts = 1;
  }
  message DisableConfidentialCredits {
    CreditsAccounts accounts = 1;
  }
  message EnableNonConfidentialCredits {
    CreditsAccounts accounts = 1;
  }
  message DisableNonConfidentialCredits {
    CreditsAccounts accounts = 1;
  }
  message TransferWithFee {
    TransferWithFeeAccounts accounts = 1;
  }
  message ConfigureAccountWithRegistry {
    ConfigureAccountWithRegistryAccounts accounts = 1;
  }

  oneof instruction {
    InitializeMint initialize_mint = 1;
    UpdateMint update_mint = 2;
    ConfigureAccount configure_account = 3;
    ApproveAccount approve_account = 4;
    EmptyAccount empty_account = 5;
    Deposit deposit = 6;
    Withdraw withdraw = 7;
    Transfer transfer = 8;
    ApplyPendingBalance apply_pending_balance = 9;
    EnableConfidentialCredits enable_confidential_credits = 10;
    DisableConfidentialCredits disable_confidential_credits = 11;
    EnableNonConfidentialCredits enable_non_confidential_credits = 12;
    DisableNonConfidentialCredits disable_non_confidential_credits = 13;
    TransferWithFee transfer_with_fee = 14;
    ConfigureAccountWithRegistry configure_account_with_registry = 15;
  }
}

// ── Confidential Transfer Fee Extension ────────────────────────────

message InitializeConfidentialTransferFeeConfigAccounts {
  bytes mint = 1;
}

message ConfidentialWithdrawWithheldTokensFromMintAccounts {
  bytes mint = 1;
  bytes fee_recipient = 2;
  bytes sysvar = 3;
  bytes withdraw_withheld_authority = 4;
  repeated bytes multisig_signers = 5;
}

message ConfidentialWithdrawWithheldTokensFromAccounts {
  bytes mint = 1;
  bytes fee_recipient = 2;
  bytes sysvar = 3;
  bytes withdraw_withheld_authority = 4;
  repeated bytes source_accounts = 5;
  repeated bytes multisig_signers = 6;
}

message ConfidentialHarvestWithheldTokensToMintAccounts {
  bytes mint = 1;
  repeated bytes source_accounts = 2;
}

message EnableHarvestToMintAccounts {
  bytes mint = 1;
  bytes confidential_transfer_fee_authority = 2;
  repeated bytes multisig_signers = 3;
}

message DisableHarvestToMintAccounts {
  bytes account = 1;
  bytes confidential_transfer_fee_authority = 2;
  repeated bytes multisig_signers = 3;
}

message ConfidentialTransferFeeIx {
  message InitializeConfidentialTransferFeeConfig {
    InitializeConfidentialTransferFeeConfigAccounts accounts = 1;
  }
  message WithdrawWithheldTokensFromMint {
    ConfidentialWithdrawWithheldTokensFromMintAccounts accounts = 1;
  }
  message WithdrawWithheldTokensFromAccounts {
    ConfidentialWithdrawWithheldTokensFromAccounts accounts = 1;
  }
  message HarvestWithheldTokensToMint {
    ConfidentialHarvestWithheldTokensToMintAccounts accounts = 1;
  }
  message EnableHarvestToMint {
    EnableHarvestToMintAccounts accounts = 1;
  }
  message DisableHarvestToMint {
    DisableHarvestToMintAccounts accounts = 1;
  }

  oneof instruction {
    InitializeConfidentialTransferFeeConfig initialize_confidential_transfer_fee_config = 1;
    WithdrawWithheldTokensFromMint withdraw_withheld_tokens_from_mint = 2;
    WithdrawWithheldTokensFromAccounts withdraw_withheld_tokens_from_accounts = 3;
    HarvestWithheldTokensToMint harvest_withheld_tokens_to_mint = 4;
    EnableHarvestToMint enable_harvest_to_mint = 5;
    DisableHarvestToMint disable_harvest_to_mint = 6;
  }
}

// ── Top-level instruction accounts and args ────────────────────────

message CreateNativeMintAccounts {
  bytes mint = 1;
  bytes funding_account = 2;
}

message InitializeMintCloseAuthorityAccounts {
  bytes mint = 1;
}

message InitializeMintCloseAuthorityArgs {
  optional bytes close_authority = 1;
}

message InitializeNonTransferableMintAccounts {
  bytes mint = 1;
}

message ReallocateAccounts {
  bytes account = 1;
  bytes payer = 2;
  bytes owner = 3;
  repeated bytes multisig_signers = 4;
}

message ReallocateArgs {
  repeated uint32 extension_types = 1;
}

message InitializePermanentDelegateAccounts {
  bytes account = 1;
}

message InitializePermanentDelegateArgs {
  bytes delegate = 1;
}

message WithdrawExcessLamportsAccounts {
  bytes source_account = 1;
  bytes destination_account = 2;
  bytes authority = 3;
  repeated bytes multisig_signers = 4;
}

message SetAuthorityArgs {
  AuthorityType authority_type = 1;
  optional bytes new_authority = 2;
}

// ── Instruction wrappers ───────────────────────────────────────────

message TokenProgramInstruction {
  vixen.parser.token.TokenProgram instruction = 1;
}

message SetAuthorityInstruction {
  vixen.parser.token.SetAuthorityAccounts accounts = 1;
  SetAuthorityArgs args = 2;
}

message CreateNativeMintInstruction {
  CreateNativeMintAccounts accounts = 1;
}

message InitializeMintCloseAuthorityInstruction {
  InitializeMintCloseAuthorityAccounts accounts = 1;
  InitializeMintCloseAuthorityArgs args = 2;
}

message InitializeNonTransferableMintInstruction {
  InitializeNonTransferableMintAccounts accounts = 1;
}

message ReallocateInstruction {
  ReallocateAccounts accounts = 1;
  ReallocateArgs args = 2;
}

message InitializePermanentDelegateInstruction {
  InitializePermanentDelegateAccounts accounts = 1;
  InitializePermanentDelegateArgs args = 2;
}

message WithdrawExcessLamportsInstruction {
  WithdrawExcessLamportsAccounts accounts = 1;
}

message TransferFeeInstruction {
  TransferFeeIx instruction = 1;
}

message ConfidentialTransferInstruction {
  ConfidentialTransferIx instruction = 1;
}

message ConfidentialTransferFeeInstruction {
  ConfidentialTransferFeeIx instruction = 1;
}

message CpiGuardInstruction {
  CommonExtensionInstructions instruction = 1;
}

message DefaultAccountStateInstruction {
  CommonExtensionInstructions instruction = 1;
}

message GroupMemberPointerInstruction {
  CommonExtensionInstructions instruction = 1;
}

message GroupPointerInstruction {
  CommonExtensionInstructions instruction = 1;
}

message InterestBearingMintInstruction {
  CommonExtensionInstructions instruction = 1;
}

message MemoTransferInstruction {
  CommonExtensionInstructions instruction = 1;
}

message MetadataPointerInstruction {
  CommonExtensionInstructions instruction = 1;
}

message TransferHookInstruction {
  CommonExtensionInstructions instruction = 1;
}

message TokenMetadataInstruction {
  TokenMetadataIx instruction = 1;
}

message TokenGroupInstruction {
  TokenGroupIx instruction = 1;
}

// ── Dispatch ───────────────────────────────────────────────────────

message TokenExtensionProgram {
  oneof instruction {
    TokenProgramInstruction token_program = 1;
    SetAuthorityInstruction set_authority = 2;
    CreateNativeMintInstruction create_native_mint = 3;
    InitializeMintCloseAuthorityInstruction initialize_mint_close_authority = 4;
    InitializeNonTransferableMintInstruction initialize_non_transferable_mint = 5;
    ReallocateInstruction reallocate = 6;
    InitializePermanentDelegateInstruction initialize_permanent_delegate = 7;
    WithdrawExcessLamportsInstruction withdraw_excess_lamports = 8;
    TransferFeeInstruction transfer_fee = 9;
    ConfidentialTransferInstruction confidential_transfer = 10;
    ConfidentialTransferFeeInstruction confidential_transfer_fee = 11;
    CpiGuardInstruction cpi_guard = 12;
    DefaultAccountStateInstruction default_account_state = 13;
    GroupMemberPointerInstruction group_member_pointer = 14;
    GroupPointerInstruction group_pointer = 15;
    InterestBearingMintInstruction interest_bearing_mint = 16;
    MemoTransferInstruction memo_transfer = 17;
    MetadataPointerInstruction metadata_pointer = 18;
    TransferHookInstruction transfer_hook = 19;
    TokenMetadataInstruction token_metadata = 20;
    TokenGroupInstruction token_group = 21;
  }
}
